<div class="note__item">
  <div class="note__day"></div>

  <div class="note__list" style="font-size: 85%;">

    <div id="feed-reader"></div>

    <script>
      const feedURL = 'https://status.cafe/users/acupofwind.atom'; // ← 改成你的

      function timeAgo(publishedDate) {
        const now = new Date();
        const published = new Date(publishedDate);
        const diff = now - published;

        const seconds = Math.floor(diff / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);

        if (days > 0) return `${days} 天${days > 1 ? '' : ''} 前`;
        if (hours > 0) return `${hours} 小时${hours > 1 ? '' : ''} 前`;
        if (minutes > 0) return `${minutes} 分钟${minutes > 1 ? '' : ''} 前`;
        return `${seconds} 秒${seconds > 1 ? '' : ''} 前`;
      }

      fetch(feedURL)
        .then(r => r.text())
        .then(str => new DOMParser().parseFromString(str, "text/xml"))
        .then(data => {
          const el = data.querySelector("entry"); // ★ 只取第一条

          if (!el) return;

          let rawTitle = el.querySelector("title").textContent.trim();
          let emojiMatch = rawTitle.match(/[\p{Emoji}]/gu);
          let emoji = emojiMatch ? emojiMatch.join('').replace(/[0-9]+$/, '') : '';

          let content = el.querySelector("content").textContent.trim();
          let publishedDate = el.querySelector("published").innerHTML;
          let relativeTime = timeAgo(publishedDate);

          const html = `
            <div class="statuscafe-entry">
              <p class="statuscafe-username">
                <span class="status-meta">
                  <span class="mumble-time">${relativeTime}</span>
                  <span class="mumble-title">${emoji}</span>
                </span>
              </p>
              <p class="statuscafe-content">${content}</p>
            </div>
          `;

          document.getElementById("feed-reader").innerHTML = html;
        });
    </script>

  </div>
</div>
